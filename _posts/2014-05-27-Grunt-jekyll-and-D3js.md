---
title: "Grunt, jekyll and D3.js - Together!!!"
tags: 
  - grunt
  - jekyll
  - d3js
  - data visualization
permalink: "/content/grunt-jekyll-and-d3js"
layout: post
published: true
---

At the Beginning of 2014, we worked in a interesting project, to create an mobile web site for an exposition for a museum in madrid [Casa del Lector](http://www.gizra.com/content/casa-del-lector/).

Create an backendless application, that generates the site into two languages ([english](http://gizra.github.io/CDL/)/[spanish](http://gizra.github.io/CDL-ES/)) was absorbing, this begun looking components and best practices to achieve the architecture of an "Autogenerated Site Backendless".

Sound fancy, ;) but it's just a short name to explain, how we can assemble some great tools of the Web Platform of today, like [gruntjs](http://gruntjs.com/) and it's plugins, [jekyll](http://jekyllrb.com/d3) and [D3](http://d3js.org/) for this project, and help us to build amazing things.

<!-- more -->

---

Then, the most common situation when you looking something to re-use in the open source community, is that exist something similar but not exactly what you need.

Here is our experience gained!, may could be useful if you developing something similar.


# Backendless, _You have a lot of data, but it's not in a server?_?

In our case, all the data come from a imported XML (without any XML schema), generated by a 3rd. party desktop application used by the museum.

This have to be analized, transformed and prepared to be used by d3js and the jekyll templates.

Was realized by creating 3 [custom task](http://gruntjs.com/creating-tasks) with grunt, the data could be different many times in a day.

To see the [code](https://github.com/Gizra/CDL/blob/master/Gruntfile.js) working, .

For this, you can write in command line of the terminal:

```bash
grunt serve
```

this prepare data, generate pages and run a server locally normally used to development, and testing. Then with;

```bash
grunt build
```

also prepare data, generate pages and finally publish the site [github pages](https://pages.github.com/)

to accomplish all of this we use some great [grunt plugins](http://gruntjs.com/plugins) like [grunt-text-replace](https://github.com/yoniholmes/grunt-text-replace), [he](https://github.com/mathiasbynens/he) HTML encoder/decoder, [underscore](https://github.com/jashkenas/underscore), [grunt-convert](https://github.com/assemble/grunt-convert) and [grunt-gh-pages](https://github.com/tschaub/grunt-gh-pages).


# Site Autogenerated

We wrote [jekyll templates](http://jekyllrb.com/docs/templates/), once the data was ready in json files. we found issues of encoding and complex nested view in the generation process.

so we back to the custom task in grunt, to fix the encoding of the files, prepare the data in the bast possible way for easy declaration of jekyll templates.

[jekyll + yeoman](https://github.com/robwierzbowski/generator-jekyllrb) it's mighty combination!


# Node map, D3js visualization

We select great [examples](https://github.com/mbostock/d3/wiki/Gallery) that help us to build node map, this library worked similar as jquery does with DOM manipulation.

However to get improve mobile performance, was necessary re-think beyond the examples and the API recommendation.

If you work in a mobile application with d3js, it's crucial use tools like [chrome devtools timeline](https://developer.chrome.com/devtools/docs/timeline) to keep for example the animations and interactions below 60fps.

In an general way, the most problematics issues in performance are related handle events and animations, try to apply throttle or debounce concepts for the events and do not attach animation on the events stataments.

Instead, use CSS Animations and handle this with another visualization layer.

Here an [fabulous talk](http://www.youtube.com/watch?v=90NsjKvz9Ns&list=PL37ZVnwpeshFXOP2lqCUykYPXYNsK_fgN&feature=share) from JSConf 2014, explained this.


# Mobile Target, performance matters?

Oh!, data visualization in a iPad or a mobiles phone. So, Yes performance really matters!

Beside a responsive design of the templates, we follow good practice for mobile sites and application target, a fluid navigation and a good response in the touch events was our needs.

we remove the [300ms](http://updates.html5rocks.com/2013/12/300ms-tap-delay-gone-away) by double-tap zoom, we tke care about the target size in the node map as [Tim Park](https://www.youtube.com/watch?v=vzOy_ldZNXQ&feature=youtu.be&t=2m18s) recommend in his talk.

And finally we add son [debounce](http://drupalmotion.com/article/debounce-and-throttle-visual-explanation) to deal with the multiple events trigger in the zoom event of d3js, according the devices like touch, and mouse events.




